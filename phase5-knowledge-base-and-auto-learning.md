# 지식베이스 관리 UI + Phase 5: 자동 규칙 학습

---

## Part 1: 지식베이스 탭 — CRUD UI

기존 "지식베이스" 탭이 네비게이션에 이미 있음. 해당 컴포넌트를 찾아서 교체/확장.

### 3개 섹션 (탭 또는 아코디언)

#### 섹션 1: 브랜드 보이스 규칙 (brand_voice_rules)

데이터 소스: brand_voice_rules 테이블

목록 표시:
```
┌─────────────────────────────────────────────────────────┐
│ 브랜드 보이스 규칙                        [+ 규칙 추가]  │
├─────────────────────────────────────────────────────────┤
│ 🚫 금지어  │ "뷰티 디바이스" 사용 금지                    │
│            │ ❌ 뷰티 디바이스 → ✅ 메디컬 에스테틱 디바이스  │
│            │ 채널: 전체 │ 출처: manual        [수정][삭제]│
├─────────────────────────────────────────────────────────┤
│ 🎯 선호어  │ 토르RF 첫 등장 시 'TORR RF' 병기             │
│            │ 채널: 전체 │ 출처: manual        [수정][삭제]│
├─────────────────────────────────────────────────────────┤
│ 🤖 학습됨  │ 출처 불명 표현 사용 주의 (3회 반복 감지)      │
│            │ 채널: email │ 출처: learned       [수정][삭제]│
└─────────────────────────────────────────────────────────┘
```

추가/수정 폼:
```
┌─────────────────────────────────────────────────┐
│ 규칙 추가                                        │
│                                                   │
│ 유형: [금지어 ▼] (banned_term/preferred_term/     │
│        tone_rule/structure_rule/channel_specific) │
│                                                   │
│ 채널: [전체 ▼] (null=전체, email, naver_blog 등)  │
│                                                   │
│ 규칙 내용: [________________________]              │
│                                                   │
│ 잘못된 예시: [____________________] (선택)         │
│ 올바른 예시: [____________________] (선택)         │
│                                                   │
│               [취소]  [저장]                       │
└─────────────────────────────────────────────────┘
```

CRUD 함수: supabaseData.js에 이미 있음
- getAllBrandVoiceRules()
- saveBrandVoiceRule(data)
- updateBrandVoiceRule(id, data)
- deleteBrandVoiceRule(id)

rule_type 한글 매핑:
```javascript
const ruleTypeLabels = {
  'banned_term': '🚫 금지어',
  'preferred_term': '🎯 선호어',
  'tone_rule': '🎨 톤/문체',
  'structure_rule': '📐 구조',
  'channel_specific': '📺 채널 특수'
};
```

source 표시:
- 'manual': "직접 추가" 뱃지 (파란색)
- 'learned': "🤖 AI 학습" 뱃지 (녹색)

#### 섹션 2: 팩트 데이터베이스 (fact_database)

목록 표시:
```
┌─────────────────────────────────────────────────────────┐
│ 팩트 데이터베이스                          [+ 팩트 추가]  │
├─────────────────────────────────────────────────────────┤
│ 👤 인물    │ 대표이사: 이신재                             │
│            │ 유효기간: 제한 없음              [수정][삭제]│
├─────────────────────────────────────────────────────────┤
│ 🏢 회사    │ 브릿츠메디 2017년 설립                       │
│            │ 유효기간: 제한 없음              [수정][삭제]│
├─────────────────────────────────────────────────────────┤
│ 📋 인증    │ 토르RF FDA 승인 (EBD 분류)                   │
│            │ 유효기간: 제한 없음              [수정][삭제]│
└─────────────────────────────────────────────────────────┘
```

추가/수정 폼:
```
┌─────────────────────────────────────────────────┐
│ 팩트 추가                                        │
│                                                   │
│ 카테고리: [회사 ▼] (company/product/partnership/  │
│           certification/clinical/market/          │
│           personnel/event)                        │
│                                                   │
│ 주제: [________________________]                  │
│ (예: 토르RF, 이신재, 더마 솔루션스)               │
│                                                   │
│ 팩트 내용: [________________________]              │
│                                                   │
│ 함께 사용할 정보: [________________] (선택, 쉼표구분)│
│ (예: FDA 승인, EBD 분류)                           │
│                                                   │
│ 유효 시작일: [________] (선택)                     │
│ 유효 종료일: [________] (선택)                     │
│                                                   │
│               [취소]  [저장]                       │
└─────────────────────────────────────────────────┘
```

CRUD 함수: supabaseData.js에 이미 있음
- getAllFacts()
- saveFact(data)
- updateFact(id, data)
- deleteFact(id)

category 한글 매핑:
```javascript
const factCategoryLabels = {
  'company': '🏢 회사',
  'product': '📦 제품',
  'partnership': '🤝 파트너십',
  'certification': '📋 인증',
  'clinical': '🔬 임상',
  'market': '📊 시장',
  'personnel': '👤 인물',
  'event': '📅 이벤트'
};
```

#### 섹션 3: 콘텐츠 블록 (content_blocks) — 간단히

아직 데이터가 없으므로 기본 CRUD만 제공.
나중에 승인된 콘텐츠에서 자동 추출하는 기능 추가 예정.

목록 + 추가/수정 폼:
- label: 블록 이름
- body: 내용 (textarea)
- category: company_intro, product_desc, partnership, certification, market_data, ceo_quote, boilerplate
- tags: 태그 (쉼표 구분 입력 → 배열 저장)

---

## Part 2: Phase 5 — 자동 규칙 학습

### 목적

edit_history에서 같은 패턴이 반복되면, brand_voice_rules에 추가할 것을 제안.
사용자가 승인하면 규칙으로 등록.

### 구현 위치: 대시보드 Intelligence 탭의 "빈출 수정 패턴" 카드

현재: 패턴 목록만 보여줌
변경: 3회 이상 반복된 패턴 옆에 "규칙으로 등록" 버튼 추가

```
┌─ 빈출 수정 패턴 TOP 5 ──────────────────────────────┐
│                                                       │
│ 3회 │ 🔴 출처 없는 내용 작성        [규칙으로 등록 →] │
│ 1회 │ 🔴 숫자 누락                                    │
│ 1회 │ 🟡 부자연스러운 표현                             │
└───────────────────────────────────────────────────────┘
```

### "규칙으로 등록" 클릭 시

1. 패턴 텍스트를 분석하여 rule_type 자동 추천:
   - "금지어", "사용 금지", "용어" → banned_term
   - "출처", "날조", "근거 없음" → banned_term (출처 불명 표현 금지)
   - "톤", "문체", "수동태", "해요체" → tone_rule
   - "구조", "누락", "빠짐" → structure_rule
   - 그 외 → tone_rule (기본값)

2. 사전 채워진 폼을 모달로 표시:
```
┌─────────────────────────────────────────────────┐
│ 학습 규칙 등록                                    │
│                                                   │
│ 감지된 패턴: "출처 없는 내용: 소스에 근거 없음"     │
│ 반복 횟수: 3회                                    │
│                                                   │
│ 유형: [금지어 ▼] ← 자동 추천됨                    │
│ 채널: [전체 ▼] ← 해당 채널에서만 발생했으면 채널 지정│
│                                                   │
│ 규칙 내용: [소스에 근거 없는 정보를 생성하지 말 것]  │
│            ← 패턴에서 자동 생성                     │
│                                                   │
│ 잘못된 예시: [________________________] (선택)     │
│ 올바른 예시: [________________________] (선택)     │
│                                                   │
│               [취소]  [규칙 등록]                   │
└─────────────────────────────────────────────────┘
```

3. 등록 시:
```javascript
await saveBrandVoiceRule({
  rule_type: selectedType,
  channel: selectedChannel || null,
  rule_text: ruleText,
  bad_example: badExample || null,
  good_example: goodExample || null,
  source: 'learned',        // ★ 자동 학습 출처
  confidence: 0.7,          // 반복 횟수에 비례 (3회=0.7, 5회=0.8, 10회=0.9)
  is_active: true
});
```

4. 등록 후: 
   - 대시보드의 학습 자산 현황 카운트 업데이트
   - 해당 패턴 옆에 "✅ 규칙 등록됨" 표시
   - 다음 콘텐츠 생성 시 Context Builder가 자동으로 이 규칙을 주입

### 지식베이스에서도 학습 규칙 확인 가능

지식베이스 탭에서:
- source가 'learned'인 규칙은 "🤖 AI 학습" 뱃지 표시
- 직접 추가한 규칙은 "직접 추가" 뱃지 표시
- 학습 규칙도 수정/삭제 가능

---

## 디자인

기존 BRITZMEDI 디자인 톤 유지:
- 카드: bg-white rounded-xl border border-pale
- 버튼: 기존 accent/brown 톤
- 뱃지: 작은 rounded-full px-2 py-0.5
- 모달: 기존 프로젝트의 모달 스타일 참고 (Pipeline 상세 모달 등)
- 테이블/리스트: 기존 스타일 참고
- 반응형: 모바일에서도 사용 가능

삭제 시 확인 다이얼로그:
```javascript
if (window.confirm('이 규칙을 삭제하시겠습니까?')) {
  await deleteBrandVoiceRule(id);
  // 목록 새로고침
}
```

---

## 빌드 + 테스트

### Part 1 테스트:
1. 지식베이스 탭 클릭 → 3개 섹션 표시
2. 브랜드 보이스 규칙: 12개 표시, 수정/삭제 작동
3. 팩트 DB: 5개 표시, 수정/삭제 작동
4. 새 규칙 추가 → 목록에 반영
5. 새 팩트 추가 → 목록에 반영

### Part 2 테스트:
1. 대시보드 → 빈출 수정 패턴에서 3회 이상 항목에 "규칙으로 등록" 버튼 존재
2. 클릭 → 사전 채워진 폼 모달
3. 등록 → 지식베이스 탭에서 source='learned' 뱃지로 확인
4. 새 콘텐츠 생성 → F12에서 [ContextBuilder]에 해당 규칙 포함 확인

배포 + git push.

---

## 파일 목록 (예상)

1. src/components/knowledge/KnowledgeBase.jsx — 새 파일 또는 기존 지식베이스 교체
2. src/components/dashboard/IntelligenceDashboard.jsx — "규칙으로 등록" 버튼 + 모달 추가
